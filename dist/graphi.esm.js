function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(n,!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function normalizeComponent(t,e,n,r,i,o,s,a,c,d){"boolean"!=typeof s&&(c=a,a=s,s=!1);var u="function"==typeof n?n.options:n;t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,i&&(u.functional=!0)),r&&(u._scopeId=r);var l;if(o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},u._ssrRegister=l):e&&(l=s?function(){e.call(this,d(this.$root.$options.shadowRoot))}:function(t){e.call(this,a(t))}),l)if(u.functional){var h=u.render;u.render=function(t,e){return l.call(e),h(t,e)}}else{var f=u.beforeCreate;u.beforeCreate=f?[].concat(f,l):[l]}return n}var d3=require("d3"),script={name:"graphi",props:{value:{type:Object,default:function(){}},conf:{type:Object,default:function(){return{width:0,height:0,zoomToFit:!0,bubbleRadius:60,arrowOffset:0}}}},data(){return{force:void 0,nodes:Array.prototype.constructor(),edges:Array.prototype.constructor(),links:void 0,linksText:void 0,linksTextPath:void 0,gs:void 0,svg:void 0,g:void 0,dto:void 0}},mounted(){this.build()},methods:{trueOfalse(t,e,n){return!!t&&!(t.hasOwnProperty(e)&&!n(t[e]))},preBuild(t){return!(!t||!t.name||t.childs.constructor!==Array)&&(!!this.trueOfalse(this.conf,"width",function(t){return/\d+/.test(t)&&"number"==typeof t})&&(!!this.trueOfalse(this.conf,"height",function(t){return/\d+/.test(t)&&"number"==typeof t})&&(!!this.trueOfalse(this.conf,"bubbleRadius",function(t){return/\d+/.test(t)&&"number"==typeof t})&&(!!this.trueOfalse(this.conf,"arrowOffset",function(t){return/\d+/.test(t)&&"number"==typeof t})&&!!this.trueOfalse(this.conf,"zoomToFit",function(t){return"boolean"==typeof t})))))},build(t){t=t||this.value,this.preBuild(t)&&(this.dto=t,this.assemble(this.dto),this.svg&&this.force||this.initGraph(),this.update())},assemble(t){if(t){var e=Array.prototype.constructor(),n=_objectSpread2({},this.vencrt("name",t.name),{},{rel:"origin"});e.push(n),e=(e=(e=e.concat(this.noderix(t.childs,"childs"))).concat(this.noderix(t.members,"members"))).concat(this.noderix(t.outsides,"outsides"));for(var r=Array.prototype.constructor(),i=0;i<e.length;i++){var o=e[i];0!==i&&r.push(this.vencrts(i,o))}this.nodes=e,this.edges=r}},noderix(t,e){for(var n=Array.prototype.constructor(),r=0;r<t.length;r++){var i=t[r];n.push(_objectSpread2({},this.vencrt("name",i.name),{},this.vencrt("rel",e)))}return n},vencrts(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={childs:this.random(3,4),members:this.random(2,3),outsides:this.random(2,4)}[e.rel];return _objectSpread2({},this.vencrt("source",t),{},this.vencrt("target",n),{},this.vencrt("value",r),{},this.vencrt("relation",e.rel))},vencrt(t,e){var n=Object.create(null);return n[t]=e,n},initGraph(){this.conf.width=this.conf.width||this.$el.clientWidth,this.conf.height=this.conf.height||500;var t={top:60,bottom:60,left:60,right:60},e=d3.zoom().scaleExtent([.2,8]).on("zoom",this.trans);if(this.svg=d3.select(".graphi").append("svg").attr("width",this.conf.width).attr("height",this.conf.height).call(e).on("dblclick.zoom",null),this.conf.zoomToFit){this.svg.transition().duration(750).call(e.transform,d3.zoomIdentity.translate(this.resize(.6).zoomWidth,this.resize(.6).zoomHeight).scale(.6))}this.g=this.svg.append("g").attr("transform",`translate(${t.top},${t.left})`),this.force=d3.forceSimulation().force("charge",d3.forceManyBody().strength(-900)).force("link",d3.forceLink().distance(50)).force("center",d3.forceCenter())},tick(){this.links&&this.linksText&&this.gs&&(this.links.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),this.linksTextPath.attr("d",function(t){return"M "+t.source.x+" "+(t.source.y-5)+" L "+t.target.x+" "+t.target.y}),this.linksText.attr("transform",function(t){if(t.target.x<t.source.x){var e=this.getBBox();return"rotate(180 "+(e.x+e.width/2)+" "+(e.y+e.height/2)+")"}return"rotate(0)"}),this.gs.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}))},update(){var t=this,e=d3.scaleOrdinal().domain(d3.range(this.nodes.length)).range(d3.schemeCategory10);e=function(t){return{origin:"#8788D3",childs:"#86C99E",members:"#CFD0EE",outsides:"#FDD495"}[t.rel]},this.force.nodes(this.nodes).on("tick",this.tick),this.force.force("link").links(this.edges).distance(function(t){return 100*t.value}),this.force.force("center").x(this.conf.width/2).y(this.conf.height/2);var n=this.g.append("g");this.links=n.selectAll("line").data(this.edges).enter().append("line").attr("stroke",function(t,e){return"#ccc"}).attr("class",function(t){return"members"===t.relation?"link link_dashed":"link link_continuous"}).attr("stroke-width",1).attr("marker-start","url(#arrow)"),n.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 20 20").attr("refX",function(e){return-(t.conf.bubbleRadius+15+(t.conf.arrowOffset||0))}).attr("refY",0).attr("markerWidth",15).attr("markerHeight",15).attr("orient","auto").append("path").attr("d","M0,0L10,-5L10,5").attr("fill","#ccc").attr("class","arrowhead");var r=this.g.append("g");this.linksTextPath=r.selectAll(".edgepath").data(this.edges).enter().append("path").attr("class","edgepath").attr("fill-opacity",0).attr("stroke-opacity",0).attr("id",function(t,e){return"edgepath"+e}).style("pointer-events","none"),this.linksText=r.selectAll(".edgelabel").data(this.edges).enter().append("text").style("pointer-events","none").attr("class","edgelabel").attr("id",function(t,e){return"edgelabel"+e}).attr("font-size",10).attr("fill","#aaa"),this.linksText.append("textPath").data(this.edges).attr("xlink:href",function(t,e){return"#edgepath"+e}).style("text-anchor","middle").style("pointer-events","none").attr("startOffset","50%").text(function(t){return t.relation}),this.gs=this.g.selectAll(".circleText").data(this.nodes).enter().append("g").attr("transform",function(t,e){return"translate("+t.x+","+t.y+")"}).call(d3.drag().on("start",this.started).on("drag",this.dragged).on("end",this.ended)),this.gs.append("circle").attr("r",function(e){return 0===e.index?t.conf.bubbleRadius+10:0}).attr("fill",function(t,e){return"#D1D2EE"}),this.gs.append("circle").attr("r",this.conf.bubbleRadius).attr("fill",function(t,n){return e(t)}),this.gs.append("text").attr("x",0).style("text-anchor","middle").style("font-weight","normal").style("pointer-events","none").style("fill",function(t){return{origin:"#FFFFFF",childs:"#FFFFFF",members:"#8788D3",outsides:"#B4843A"}[t.rel]}).attr("dy",".35em").text(function(t){return t.name}).call(this.wrap)},wrap(t){var e=this;t.each(function(){for(var t,n=2*e.conf.bubbleRadius,r=d3.select(this),i=r.text().split("").reverse(),o=[],s=0,a=r.attr("x"),c=r.attr("y"),d=r.text(null).append("tspan").attr("x",a).attr("y",c).attr("dy","0em");t=i.pop();)o.push(t),d.text(o.join("")),d.node().getComputedTextLength()>n&&(o.pop(),d.text(o.join("")),o=[t],d=r.append("tspan").attr("x",a).attr("y",c).attr("dy",1.1*++s+0+"em").text(t));r.attr("alignment-baseline","central"),r.attr("dominant-baseline","central")})},trans(){this.g.attr("transform",d3.event.transform)},resize(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.getSize(t)},getSize(t){var e=this.$el.clientWidth,n=this.$el.clientHeight;return{zoomWidth:(e-t*e)/2,zoomHeight:(n-t*n)/2}},started(t){d3.event.active||this.force.alphaTarget(.8).restart(),t.fx=t.x,t.fy=t.y},dragged(t){t.fx=d3.event.x,t.fy=d3.event.y},ended(t){d3.event.active||this.force.alphaTarget(0),t.fx=null,t.fy=null},random(t,e){return Math.random()*(e-t)+t}},watch:{value(t){this.build(t)}}},normalizeComponent_1=normalizeComponent;const __vue_script__=script;var __vue_render__=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"graphi"})},__vue_staticRenderFns__=[];__vue_render__._withStripped=!0;const __vue_inject_styles__=void 0,__vue_scope_id__="data-v-4c88c745",__vue_module_identifier__=void 0,__vue_is_functional_template__=!1;var Main=normalizeComponent_1({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},void 0,__vue_script__,__vue_scope_id__,!1,void 0,void 0,void 0),components=[Main],install=function(t){components.forEach(function(e){t.component(e.name,e)})};"undefined"!=typeof window&&window.Vue&&install(window.Vue);export default install;export{Main as Graphi};
