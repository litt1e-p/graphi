var graphi=function(t){"use strict";function e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(Object(i),!0).forEach((function(r){e(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var i=require("d3");function o(t,e,r,n,i,o,s,a,c,h){"boolean"!=typeof s&&(c=a,a=s,s=!1);var u,l="function"==typeof r?r.options:r;if(t&&t.render&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns,l._compiled=!0,i&&(l.functional=!0)),n&&(l._scopeId=n),o?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=u):e&&(u=s?function(t){e.call(this,h(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,a(t))}),u)if(l.functional){var d=l.render;l.render=function(t,e){return u.call(e),d(t,e)}}else{var f=l.beforeCreate;l.beforeCreate=f?[].concat(f,u):[u]}return r}var s={name:"graphi",props:{value:{type:Object,default:function(){}},conf:{type:Object,default:function(){return{width:0,height:0,zoomToFit:!0,fitScale:.6,bubbleRadius:60,arrowOffset:0,relations:void 0}}}},data:function(){return{force:void 0,nodes:Array.prototype.constructor(),edges:Array.prototype.constructor(),links:void 0,linksText:void 0,linksTextPath:void 0,gs:void 0,svg:void 0,g:void 0,zoom:void 0,dto:void 0}},mounted:function(){this.build()},methods:{trueOfalse:function(t,e,r){return!!t&&!(t.hasOwnProperty(e)&&!r(t[e]))},preBuild:function(t){return!(!t||!t.name||t.childs.constructor!==Array)&&(!!this.trueOfalse(this.conf,"width",(function(t){return/\d+/.test(t)&&"number"==typeof t}))&&(!!this.trueOfalse(this.conf,"height",(function(t){return/\d+/.test(t)&&"number"==typeof t}))&&(!!this.trueOfalse(this.conf,"bubbleRadius",(function(t){return/\d+/.test(t)&&"number"==typeof t}))&&(!!this.trueOfalse(this.conf,"arrowOffset",(function(t){return/\d+/.test(t)&&"number"==typeof t}))&&!!this.trueOfalse(this.conf,"zoomToFit",(function(t){return"boolean"==typeof t}))))))},build:function(t){t=JSON.parse(JSON.stringify(t||this.value)),this.preBuild(t)&&(this.dto=t,this.assemble(this.dto),this.svg&&this.force||this.initGraph(),this.update())},assemble:function(t){if(t){var e=Array.prototype.constructor(),r=n(n({},this.vencrt("name",t.name)),{rel:"origin"});e.push(r),e=(e=(e=e.concat(this.noderix(t.childs,"childs"))).concat(this.noderix(t.members,"members"))).concat(this.noderix(t.outsides,"outsides"));for(var i=Array.prototype.constructor(),o=0;o<e.length;o++){var s=e[o];0!==o&&i.push(this.vencrts(o,s))}this.nodes=e,this.edges=i}},noderix:function(t,e){for(var r=Array.prototype.constructor(),i=0;i<t.length;i++){var o=t[i];r.push(n(n(n({},this.vencrt("name",o.name)),this.vencrt("rel",e)),this.vencrt("data",o)))}return r},vencrts:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={childs:this.random(3,4),members:this.random(2,3),outsides:this.random(2,4)}[e.rel];return n(n(n(n({},this.vencrt("source",t)),this.vencrt("target",r)),this.vencrt("value",i)),this.vencrt("relation",e.rel))},vencrt:function(t,e){var r=Object.create(null);return r[t]=e,r},sizeToFit:function(){var t=this.conf.fitScale||.6;this.svg.transition().duration(750).call(this.zoom.transform,i.zoomIdentity.translate(this.resize(t).zoomWidth,this.resize(t).zoomHeight).scale(t))},initGraph:function(){this.conf.width=this.conf.width||this.$el.clientWidth,this.conf.height=this.conf.height||500;var t=60,e=60,r=i.zoom().scaleExtent([.2,8]).on("zoom",this.trans);this.svg=i.select(".svg").call(r).on("dblclick.zoom",null),this.zoom=r,this.conf.zoomToFit&&this.sizeToFit(),this.g=this.svg.append("g").attr("transform","translate(".concat(t,",").concat(e,")")),this.force=i.forceSimulation().force("charge",i.forceManyBody().strength(-900)).force("link",i.forceLink().distance(50)).force("center",i.forceCenter())},tick:function(){this.links&&this.linksText&&this.gs&&(this.links.attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),this.linksTextPath.attr("d",(function(t){return"M "+t.source.x+" "+(t.source.y-5)+" L "+t.target.x+" "+t.target.y})),this.linksText.attr("transform",(function(t){if(t.target.x<t.source.x){var e=this.getBBox();return"rotate(180 "+(e.x+e.width/2)+" "+(e.y+e.height/2)+")"}return"rotate(0)"})),this.gs.attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})))},_getRel:function(t){if(this.conf.relations&&Object.keys(this.conf.relations).length>0){var e=this.conf.relations[t.relation];if("[object String]"===Object.prototype.toString.call(e))return e;if("[object Array]"===Object.prototype.toString.call(e)){var r=t.source.data.key||"id",n=e.find((function(e){return e[r]===t.source.data[r]}));if(n)return n.name}}return t.relation},update:function(){var t=this,e=i.scaleOrdinal().domain(i.range(this.nodes.length)).range(i.schemeCategory10);e=function(t){return{origin:"#8788D3",childs:"#86C99E",members:"#CFD0EE",outsides:"#FDD495"}[t.rel]},this.force.nodes(this.nodes).on("tick",this.tick),this.force.force("link").links(this.edges).distance((function(t){return 100*t.value})),this.force.force("center").x(this.conf.width/2).y(this.conf.height/2);var r=this.g.append("g");this.links=r.selectAll("line").data(this.edges).enter().append("line").attr("stroke",(function(t,e){return"#ccc"})).attr("class",(function(t){return"members"===t.relation?"link link_dashed":"link link_continuous"})).attr("stroke-width",1).attr("marker-start","url(#arrow)"),r.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 20 20").attr("refX",(function(e){return-(t.conf.bubbleRadius+15+(t.conf.arrowOffset||0))})).attr("refY",0).attr("markerWidth",15).attr("markerHeight",15).attr("orient","auto").append("path").attr("d","M0,0L10,-5L10,5").attr("fill","#ccc").attr("class","arrowhead");var n=this.g.append("g");this.linksTextPath=n.selectAll(".edgepath").data(this.edges).enter().append("path").attr("class","edgepath").attr("fill-opacity",0).attr("stroke-opacity",0).attr("id",(function(t,e){return"edgepath"+e})).style("pointer-events","none"),this.linksText=n.selectAll(".edgelabel").data(this.edges).enter().append("text").style("pointer-events","none").attr("class","edgelabel").attr("id",(function(t,e){return"edgelabel"+e})).attr("font-size",10).attr("fill","#aaa"),this.linksText.append("textPath").data(this.edges).attr("xlink:href",(function(t,e){return"#edgepath"+e})).style("text-anchor","middle").style("pointer-events","none").attr("startOffset","50%").text((function(e){return t._getRel(e)})),this.gs=this.g.selectAll(".circleText").data(this.nodes).enter().append("g").attr("transform",(function(t,e){return"translate("+t.x+","+t.y+")"})).call(i.drag().on("start",this.started).on("drag",this.dragged).on("end",this.ended)),this.gs.append("circle").attr("r",(function(e){return 0===e.index?t.conf.bubbleRadius+10:0})).attr("fill",(function(t,e){return"#D1D2EE"})),this.gs.append("circle").attr("r",this.conf.bubbleRadius).attr("fill",(function(t,r){return e(t)})),this.gs.append("text").attr("x",0).style("text-anchor","middle").style("font-weight","normal").style("pointer-events","none").style("fill",(function(t){return{origin:"#FFFFFF",childs:"#FFFFFF",members:"#8788D3",outsides:"#B4843A"}[t.rel]})).attr("dy",".35em").text((function(t){return t.name})).call(this.wrap)},wrap:function(t){var e=this;t.each((function(){for(var t,r=2*e.conf.bubbleRadius,n=i.select(this),o=n.text().split("").reverse(),s=[],a=0,c=n.attr("x"),h=n.attr("y"),u=n.text(null).append("tspan").attr("x",c).attr("y",h).attr("dy","0em");t=o.pop();)s.push(t),u.text(s.join("")),u.node().getComputedTextLength()>r&&(s.pop(),u.text(s.join("")),s=[t],u=n.append("tspan").attr("x",c).attr("y",h).attr("dy",1+.1*++a+0+"em").text(t));n.attr("alignment-baseline","central"),n.attr("dominant-baseline","central")}))},trans:function(){this.g.attr("transform",i.event.transform)},resize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.getSize(t)},getSize:function(t){var e=this.conf.width||this.$el.clientWidth,r=this.conf.height||this.$el.clientHeight;return{zoomWidth:(e-t*e)/2,zoomHeight:(r-t*r)/2}},started:function(t){i.event.active||this.force.alphaTarget(.8).restart(),t.fx=t.x,t.fy=t.y},dragged:function(t){t.fx=i.event.x,t.fy=i.event.y},ended:function(t){i.event.active||this.force.alphaTarget(0),t.fx=null,t.fy=null},random:function(t,e){return Math.random()*(e-t)+t}},watch:{value:function(t){this.build(t)}}},a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"graphi"},[r("svg",{staticClass:"svg",attrs:{width:t.conf.width,height:t.conf.height}})])};a._withStripped=!0;var c=o({render:a,staticRenderFns:[]},undefined,s,"data-v-32821208",false,undefined,!1,void 0,void 0,void 0),h=[c],u=function(t){h.forEach((function(e){t.component(e.name,e)}))};return"undefined"!=typeof window&&window.Vue&&u(window.Vue),t.Graphi=c,t.default=u,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
